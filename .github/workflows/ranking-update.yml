name: Update Ranking Automatically

on:
  push:
    paths:
      - "players.json"
  workflow_dispatch:

jobs:
  update-ranking:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Generate ranking HTML
        run: |
          echo "<html><body><h1>RPG Attack Ranking</h1><table border='1'><tr><th>Player</th><th>Attack</th></tr>" > index.html
          cat players.json | jq -r 'to_entries | .[] | "<tr><td>" + .key + "</td><td>" + (.value.attack|tostring) + "</td></tr>"' >> index.html
          echo "</table></body></html>" >> index.html

      - name: Commit and push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Update ranking automatically"
          branch: main
          commit_user_name: github-actions
          commit_user_email: actions@github.com
          token: ${{ secrets.komugi-rpg-bot-token }}
